# Для PostgreSQL 17.6
FROM postgres:17-alpine

# Установка дополнительных пакетов (опционально)
RUN apk add --no-cache \
    tzdata \
    postgresql-contrib

# Устанавливаем локаль
ENV LANG ru_RU.UTF-8
ENV LC_ALL ru_RU.UTF-8
ENV TZ Europe/Moscow

# Копируем backup
COPY backup.sql /docker-entrypoint-initdb.d/

# Можно также выполнить скрипт после инициализации
COPY post-init.sh /docker-entrypoint-initdb.d/

# Настройки производительности
RUN echo "shared_buffers = 256MB" >> /usr/share/postgresql/postgresql.conf.sample && \
    echo "max_connections = 200" >> /usr/share/postgresql/postgresql.conf.sample && \
    echo "listen_addresses = '*'" >> /usr/share/postgresql/postgresql.conf.sample

# Права на выполнение скриптов
RUN chmod +x /docker-entrypoint-initdb.d/*.sh 2>/dev/null || true

EXPOSE 5432

CMD ["postgres"]
